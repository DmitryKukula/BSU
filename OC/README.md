# 1. Объекты и их дескрипторы в Windows.
***Объектом в Windows называется структура данных, которая представляет системный ресурс. Таким
ресурсом может быть, например, файл, поток, графический рисунок.*** 

Операционные системы Windows предоставляют приложению объекты трех категорий:
  - User (объекты интерфейса пользователя);
  - Graphics Device Interface (объекты интерфейса графических устройств);
  - Kernel (объекты ядра).
    
Категория User включает объекты, которые используются приложением для интерфейса с
пользователем. К таким объектам относятся, например, окна и курсоры. 

Категория Graphics Device Interface
включает объекты, которые используются для вывода информации на графические устройства. К таким
объектам относятся, например, кисти и перья. 

Категория Kernel включает объекты ядра операционной системы
Windows. К таким объектам относятся, например, потоки и каналы. 

Под доступом к объектам понимается возможность приложения выполнять над объектом некоторые
функции. Приложение не имеет прямого доступа к объектам. Для того чтобы получить этот доступ,
необходимо использовать его дескриптор (handle). 

#### Дескриптор объекта представляет собой запись в таблице, которая поддерживается системой и содержит адрес объекта и средства для идентификации типа объекта.


---
# 2. Потоки
## 2.1. Определение потоков.
Потоком в Windows называется объект ядра, которому операционная система выделяет процессорное
время для выполнения приложения. Каждому потоку принадлежат следующие ресурсы:
  + код исполняемой функции;
  + набор регистров процессора;
  + стек для работы приложения;
  + стек для работы операционной системы;
  + блок окружения, который содержит служебную информацию для работы потока.

Все эти ресурсы образуют контекст потока в Windows. В Windows различаются потоки двух типов:
  + рабочие потоки (working threads);
  + потоки интерфейса пользователя (user interface threads).

Рабочие потоки выполняют различные фоновые задачи в приложении. Потоки интерфейса пользователя
связаны с окнами и выполняют обработку сообщений, поступающих этим окнам.

Каждое приложение имеет, по крайней мере, один поток, который называется первичным (primary) или
главным (main) потоком. В консольных приложениях это поток, который исполняет функцию main. В
приложениях с графическим интерфейсом это поток, который исполняет функцию WinMain

---
# 3. Процессы.
## 3.1. Процессы и их создание в Windows.
В Windows под процессом понимается объект ядра, которому принадлежат системные ресурсы,
используемые приложением. Поэтому можно сказать, что в Windows процессом является приложение.
Выполнение каждого процесса начинается с первичного потока. В процессе своего исполнения процесс может
создавать другие потоки. Исполнение процесса заканчивается при завершении работы всех его потоков.
Процесс может быть также завершен вызовом функций ExitProcess и TerminateProcess, которые будут
рассмотрены в следующем параграфе.
## Обслуживание потоков
Отметим, что операционная система Windows обслуживает потоки, то есть процессорное время
выделяется потокам в соответствии с их приоритетами. Приоритеты потоков в Windows определяются
относительно приоритета процесса, в рамках которого они исполняются, и изменяются от 0 (низший
приоритет) до 31 (высший приоритет).

Рассмотрим правила для назначения приоритетов процессам в Windows. Предполагается, что
операционная система Windows различает четыре типа процессов в соответствии с их приоритетами: ***фоновые
процессы, процессы с нормальным приоритетом, процессы с высоким приоритетом и процессы реального
времени***. Рассмотрим каждый из этих типов процессов чуть подробнее.

***Фоновые процессы*** выполняют свою работу, когда нет активных пользовательских процессов. Обычно,
эти процессы следят за состоянием системы.

***Процессы с нормальным приоритетом*** это обычные пользовательские процессы. 

***Процессы с высоким приоритетом*** это такие пользовательские процессы, для которых требуется
быстрая реакция на некоторые события. Эти процессы должны содержать небольшой программный код и выполняться
очень быстро, чтобы не замедлять работу системы.

К последнему типу процессов относятся ***процессы реального времени***. Работа таких процессов обычно происходит в
масштабе реального времени и связана с реакцией на внешние события. Эти процессы должны работать
непосредственно с аппаратурой компьютера

## 3.2. Наследование дескрипторов.
Большинство объектов Windows может быть наследуемыми или ненаследуемыми. Исключением из
этого правила являются объекты, использование которых несколькими процессами невозможно главным
образом по причине нарушения доступа к памяти процесса, которая изолирована от других процессов.
Свойство наследования объекта означает, что если наследуемый объект создан или открыт в некотором
процессе, то к этому объекту будут также иметь доступ все процессы, которые создаются этим процессом, то
есть являются его потомками. Свойство наследования объекта определяется его дескриптором, который также
может быть наследуемым или ненаследуемым. Для того чтобы сделать объект наследуемым, необходимо
сделать наследуемым его дескриптор и наоборот.

Однако, для того чтобы дочерний процесс имел доступ к наследуемому объекту в родительском
процессе, недостаточно просто сделать дескриптор этого объекта наследуемым. Наследуемый дескриптор
передается системой дочернему процессу, но этот дескриптор скрыт от программ, которые выполняются в
дочернем процессе. То есть программа дочернего процесса должна знать этот дескриптор и передать его этой
программе должна программа родительского процесса. Одним из способов передачи дескрипторов дочернему
процессу является использование командной строки, которая позволяет передавать дескрипторы как
параметры.

---
# 4. Синхронизация потоков.
## 4.1. Взаимодействующие потоки.
Потоки, выполнение которых перекрывается во времени, называются параллельными потоками.
Параллельные потоки, которые работают независимо друг от друга, называются асинхронными потоками.
Если же параллельные потоки обмениваются некоторыми сигналами, то они называются взаимодействующими
потоками. Сигналы, которыми обмениваются взаимодействующие потоки, могут быть двух типов:
управляющие и данные. Управляющие сигналы предназначены для координации работы взаимодействующих
потоков. Сигналы данных предназначены для обмена данными между параллельными потоками. Под
синхронизацией потоков понимается обмен управляющими сигналами между параллельными потоками по
установленному протоколу для обеспечения координации их действий. Под протоколом мы понимаем набор
правил, по которым выполняется обмен этими сигналами. Если в результате синхронизации выполняется
только один из взаимодействующих потоков, то такая синхронизация называется жѐсткой. Отметим, что
жесткая синхронизация эквивалентна последовательному выполнению программ и поэтому не дает выигрыша
во времени при выполнении параллельных потоков на мультипроцессорных компьютерах.

## 4.2. Объекты синхронизации и функции ожидания в Windows.
В операционных системах Windows объектами синхронизации называются объекты ядра, которые
могут находиться в одном из двух состояний: сигнальном (signaled) и несигнальном (nonsignaled). Объекты
синхронизации могут быть разбиты на три класса. К первому классу относятся объекты синхронизации,
которые служат только для решения проблемы синхронизации параллельных потоков. К таким объектам
синхронизации в Windows относятся:
  - мьютекс (mutex);
  - событие (event);
  - семафор (semaphore).
    
Ко второму классу объектов синхронизации относится ожидающий таймер (waitable timer). К третьему классу
объектов синхронизации относятся объекты, которые переходят в сигнальное состояние по завершении своей
работы или при получении некоторого сообщения. Примерами таких объектов синхронизации являются потоки
и процессы. Пока эти объекты выполняются, они находятся в несигнальном состоянии. Если выполнение этих
объектов заканчивается, то они переходят в сигнальное состояние.

Теперь перейдем к функциям ожидания. Функции ожидания в Windows это такие функции,
параметрами которых являются объекты синхронизации. Эти функции обычно используются для блокировки
потоков, которая выполняется следующим образом. Если дескриптор объекта синхронизации является
параметром функции ожидания, а сам объект синхронизации находится в несигнальном состоянии, то поток,
вызвавший эту функцию ожидания, блокируется до перехода этого объекта синхронизации в сигнальное
состояние. 

## 4.3. Проблема взаимного исключения.
Любой ресурс, на доступ к которому претендуют не менее двух параллельных потоков, называется
критическим или разделяемым ресурсом. Участок программы, на протяжении которого поток ведет работу с
критическим ресурсом, называется критической секцией по отношению к этому ресурсу.

В общем случае проблема взаимного исключения формулируется следующим образом. Необходимо
обеспечить такую работу параллельных потоков с критическим ресурсом, при которой гарантируется, что
критические секции этих потоков по отношению к этому ресурсу не работают одновременно.

## 4.4. Мьютексы в Windows.
Для решения проблемы взаимного исключения между параллельными потоками, выполняющимися в
контексте разных процессов, в операционных системах Windows используется объект ядра мьютекс. Слово
мьютекс является переводом английского слова mutex, которое в свою очередь является сокращением от
выражения mutual exclusion, что на русском языке значит взаимное исключение. Мьютекс находится в
сигнальном состоянии, если он не принадлежит ни одному потоку. В противном случае мьютекс находится в
несигнальном состоянии. Одновременно мьютекс может принадлежать только одному потоку.

## 4.5. События в Windows.
Событием называется оповещение о некотором выполненном действии. В программировании события
используются для оповещения одного потока о том, что другой поток выполнил некоторое действие. Сама же
задача оповещения одного потока о некотором действии, которое совершил другой поток, называется задачей
условной синхронизации или иногда задачей оповещения.
В операционных системах Windows события описываются объектами ядра Events. При этом различают два типа событий:
  - события с ручным сбросом;
  - события с автоматическим сбросом.

## 4.6. Семафоры Дейкстры.
Семафор – это неотрицательная целая переменная, значение которой может изменяться только при
помощи неделимых операций. Под понятием неделимая операция мы понимаем такую операцию, выполнение
которой не может быть прервано. Семафор считается свободным, если его значение больше нуля, в противном
случае семафор считается занятым.

Семафор, который может принимать только значения 0 или 1, называется двоичным или бинарным
семафором. Чтобы подчеркнуть отличие бинарного семафора от не бинарного семафора, то есть такого
семафора, значение которого может быть больше 1, последний обычно называют считающими семафором. 
